<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <title>Demo-Issuer</title>
  <link rel="shortcut icon" href="#">
  <style>
    textarea{
      white-space: pre-wrap;
    }
  </style>
</head>

<body>
  <h3>Issuer</h3>
  
  <h4>Preliminaries</h4>
      Serialized Global List:<br>
      <textarea id="global_list" rows="5" cols="50"></textarea><br>
      <button type="button" id="create_list">Create List</button><br>
      <br>
      Serialized Public and Verifying Keys: (this may take a while)<br>
      <textarea id="pk_and_vk" rows="5" cols="50"></textarea><br>
      <button type="button" id="setup_zk_proof">Create Public and Verifying Keys</button>
      <button type="button" id="download_pk_and_vk">Download Keys</button> 
  <hr>

  <h4>Step 2 : Adding Commit to List</h4>
      <h5> Inputs </h5>
      Global List: <br>
      <textarea id="global_list_in" rows="5" cols="50"></textarea><br>
      Commit: <br>
      <textarea id="com_and_comnonce_in" rows="5" cols="50"></textarea><br>
      
      <br><button type="button" id="insert_into_list">Insert into List</button><br>

      <h5> Output </h5>
      New Global List: <br>
      <textarea id="global_list_out" rows="5" cols="50"></textarea>  
  <hr>



  <script type="module">

    var json_pk_and_vk = "";
    var json_cred = "";
    var json_com_and_comnonce = "";
    var json_global_list = "";
    var json_auth_path = "";
    var json_membership_proof = "";
    var log_capacity = 32;

    import
        init,
        {
            zeronym_init, setup_zk_proof, cred_gen, cred_commit, create_list,
            insert_into_list, get_path, get_proof, verify, test_wasm_api_correctness, randomize,
            remove_from_list
        }
    from './zeronym.js';

    await init();
    zeronym_init();



    //PRELIMARIES

    document.getElementById("create_list").addEventListener("click", function() {
        json_global_list = create_list(log_capacity);
        document.getElementById("global_list").value = json_global_list;
    });

    document.getElementById("setup_zk_proof").addEventListener("click", function() {
        document.getElementById("pk_and_vk").value = "in progress...";
        json_pk_and_vk = setup_zk_proof(log_capacity);
        document.getElementById("pk_and_vk").value = "done. You can download the keys now.";
    });

    document.getElementById("download_pk_and_vk").addEventListener("click", function() {
        download("pk_and_vk.txt", json_pk_and_vk);
    });

    function download(filename, text) {
      var element = document.createElement('a');
      text = text.replace(/\r\n?/g, '%0D%0A');
      element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
      element.setAttribute('download', filename);

      element.style.display = 'none';
      document.body.appendChild(element);

      element.click();

      document.body.removeChild(element);
    }


    //STEP 2

    document.getElementById("insert_into_list").addEventListener("click", function() {
        json_global_list = document.getElementById("global_list_in").value;
        json_com_and_comnonce = document.getElementById("com_and_comnonce_in").value;
        json_global_list = insert_into_list(
            json_global_list,
            json_com_and_comnonce,
            0,
        );
        document.getElementById("global_list_out").value = json_global_list;
    });

















  





  </script>
</body>

</html>